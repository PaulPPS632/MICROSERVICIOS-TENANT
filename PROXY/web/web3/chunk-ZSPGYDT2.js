import{a as oe}from"./chunk-NHIA7WN2.js";import{a as he}from"./chunk-SJWRDQVH.js";import{b as ee,e as te,h as ne,i as ae,j as ie,l as re}from"./chunk-IUFCXTOM.js";import{a as Q,c as h}from"./chunk-IRNCR7DW.js";import{e as Z}from"./chunk-OMO3MP2D.js";import{c as Y}from"./chunk-FRM5A7CD.js";import{n as W,p as X}from"./chunk-FFKOQB2C.js";import{Eb as J,N as R,Na as x,Qa as u,S as k,Sa as P,T as g,Ta as j,Ua as O,Va as K,Wa as o,X as I,Xa as l,Ya as f,ab as d,bb as H,ga as F,ha as A,hb as m,jb as V,lb as q,mb as G,nb as z,pb as $,rb as B,wa as M,za as s}from"./chunk-SLZJNV7T.js";import{d as S,e as L,f as w}from"./chunk-EQDQRRRY.js";var se=S(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.default=void 0;var be=function(n,a,e){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:150,i=function c(){n[a]?e():setTimeout(c,r)};setTimeout(i,0)};C.default=be});var pe=S(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.default=void 0;var ue=_e(se());function _e(t){return t&&t.__esModule?t:{default:t}}function De(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function de(t,n){for(var a=0;a<n.length;a++){var e=n[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Se(t,n,a){return n&&de(t.prototype,n),a&&de(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var we=function(){function t(){return De(this,t),t.instance?t.instance:(t.instance=this,this._name="Krypton Glue",this.configuration={},this.domain=null,this.formToken=null,this.publicKey=null,this.loaded=!1,this.loading=!1,this)}return Se(t,[{key:"loadLibrary",value:function(a,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=/^\d{2,8}:(|test)publickey_.+$/g;if(this.loaded)return this.getKrypton(e);if(!a)return Promise.reject("Domain not defined");if(!e)return Promise.reject("Public key not defined");try{var c=new URL(a);if(!["http:","https:"].includes(c.protocol))throw new Error("Invalid protocol");if(c.port)throw new Error("No port allowed");if(c.search!=="")throw new Error("No query params allowed");if(c.pathname!=="/")throw new Error("Invalid path")}catch{return console.error("Domain format should be https://domain.name"),Promise.reject("[".concat(a,"] is not a valid endpoint domain"))}return i.test(e)?(this.domain=a,this.publicKey=e,this.formToken=r,this.domain&&this.publicKey?this.loadKryptonClient():Promise.reject("The library cannot be loaded")):(console.error("Public key format should be shopId:[test]publickey_*"),Promise.reject("[".concat(e,"] is not a valid public key")))}},{key:"loadKryptonClient",value:function(){var a=this;if(!this.loading){var e=this.publicKey,r=this.domain;this.loading=!0;var i=document.createElement("script");i.type="text/javascript",/^.+\/$/.test(r)||(r+="/"),i.src="".concat(r,"static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"),i.setAttribute("kr-public-key",e),i.setAttribute("kr-spa-mode","true"),this.formToken&&i.setAttribute("kr-form-token",this.formToken);var c=document.querySelector('script[src="'.concat(i.src,'"]'));!c&&document.body?document.body.appendChild(i):document.body||console.warn("document.body is undefined")}return new Promise(function(N){(0,ue.default)(window,"KR",function(){(0,ue.default)(window.KR,"ready",function(){a.loaded=!0,a.loading=!1,N({KR:window.KR})})})})}},{key:"getKrypton",value:function(a){var e=this;return new Promise(function(r,i){a&&a!==e.publicKey?window.KR.setFormConfig({publicKey:a}).then(r).catch(i):r({KR:window.KR})})}}]),t}(),ke=new we;b.default=ke});var me=S(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.default=void 0;var xe=Pe(pe());function Pe(t){return t&&t.__esModule?t:{default:t}}var Ee=xe.default;_.default=Ee});var p=[];for(y=0;y<256;++y)p.push((y+256).toString(16).slice(1));var y;function le(t,n=0){return(p[t[n+0]]+p[t[n+1]]+p[t[n+2]]+p[t[n+3]]+"-"+p[t[n+4]]+p[t[n+5]]+"-"+p[t[n+6]]+p[t[n+7]]+"-"+p[t[n+8]]+p[t[n+9]]+"-"+p[t[n+10]]+p[t[n+11]]+p[t[n+12]]+p[t[n+13]]+p[t[n+14]]+p[t[n+15]]).toLowerCase()}var v,ye=new Uint8Array(16);function E(){if(!v&&(v=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!v))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return v(ye)}var ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),T={randomUUID:ve};function Ce(t,n,a){if(T.randomUUID&&!n&&!t)return T.randomUUID();t=t||{};var e=t.random||(t.rng||E)();if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,n){a=a||0;for(var r=0;r<16;++r)n[a+r]=e[r];return n}return le(e)}var U=Ce;var ge=L(me());var D=class t{constructor(n,a){this.http=n;this.authService=a;this.headers=this.authService.getHeaders(),this.headersAuthorization=this.authService.getHeadersAuthorization()}apiUrl=Q.API_URL+"/tenant/payment";headersAuthorization;headers;postExternalData(n){return this.http.post(`${this.apiUrl}/external-data`,JSON.stringify(n),{headers:this.headers.append("Content-Type","application/json")})}validatePayment(n){return this.http.post(`${this.apiUrl}/validate`,n,{headers:this.headers})}getPublicKey(){return this.http.get(`${this.apiUrl}/public-key`,{headers:this.headers})}static \u0275fac=function(a){return new(a||t)(k(Y),k(h))};static \u0275prov=R({token:t,factory:t.\u0275fac,providedIn:"root"})};var fe=L(he());var Ue=t=>({transform:t});function Ne(t,n){t&1&&(o(0,"div",3)(1,"div",33),F(),o(2,"svg",34),f(3,"path",35)(4,"path",36),l(),A(),o(5,"span",37),m(6,"Loading..."),l()()())}function Le(t,n){if(t&1&&(o(0,"option",19),m(1),l()),t&2){let a=n.$implicit;u("value",a.nombre),s(),V(" ",a.nombre," ")}}function Re(t,n){if(t&1&&f(0,"img",24),t&2){let a=H();u("src",a.Logo,M)}}var ce=class t{id;router=g(Z);paymentService=g(D);chRef=g(J);authService=g(h);FlagLoading=!1;activeIndex=0;selectedFileLogo=null;Logo;ProgressStyle={width:"0%"};tiposdeNegocio=[{id:1,nombre:"electronica"},{id:1,nombre:"minimarket"},{id:1,nombre:"ferreteria"}];Precios={standar:5e3,pro:15e3,custom:2e4};DatosCuenta={usuario:{nombre:"",apellido:"",documento:"",direccion:"",telefono:"",email:"",password:"",RolId:1},tenant:{id:"",nombre:"",tiponegocio:"electronica",ruc:"",clavesol:"",paleta:"",dominio:"fryzan.com",dominiofront:"web1"},hash:{},clientAnswer:{}};DatosPago={amount:0,currency:"PEN",orderId:("ORDER-"+U()).slice(0,24),customer:{email:"",billingDetails:{firstName:"",lastName:"",cellPhoneNumber:"",address:"",district:"Ficus",city:"Santa Anita",state:"Lima",country:"PE",identityCode:"",identityType:"DNI"}}};ngOnInit(){this.id=="standar"?this.DatosPago.amount=this.Precios.standar:this.id=="pro"?this.DatosPago.amount=this.Precios.pro:this.DatosPago.amount=this.Precios.custom}ProcesoPagoTarjeta(){return w(this,null,function*(){let n="https://api.micuentaweb.pe",a="80203493:testpublickey_2h74LTfgBCifM8NOXKuDkUqYUHMbb7jUegkAJqSUYYLgl";this.PreparaDatos(),this.ProcederAPago();try{this.paymentService.postExternalData(this.DatosPago).subscribe(e=>{ge.default.loadLibrary(n,a).then(({KR:r})=>r.setFormConfig({formToken:e.formToken,"kr-language":"es-ES"})).then(({KR:r})=>r.onSubmit(i=>w(this,null,function*(){return this.paymentService.validatePayment(i).subscribe(c=>{c.Status&&(this.DatosCuenta.hash=i.hash,this.DatosCuenta.clientAnswer=i.clientAnswer,this.CreacionTenant()),this.chRef.detectChanges()},c=>{}),!0}))).then(({KR:r})=>r.renderElements("#myPaymentForm"))})}catch(e){console.error("Error en el proceso de pago: ",e)}})}CreacionTenant(){let n=new FormData;if(n.append("datos",JSON.stringify(this.DatosCuenta)),this.selectedFileLogo)n.append("file",this.selectedFileLogo);else{fe.default.fire("Error","Seleccione al menos una imagen de logo","error");return}this.authService.registerNewTenantFormData(n).subscribe(a=>{a.status&&(console.log("creacion correcta"),console.log("la ruta es: ",`http://${this.DatosCuenta.tenant.dominio}`),window.location.href=`http://${this.DatosCuenta.tenant.dominio}`)})}PreparaDatos(){this.DatosPago.customer.billingDetails.firstName=this.DatosCuenta.usuario.nombre,this.DatosPago.customer.billingDetails.lastName=this.DatosCuenta.usuario.apellido,this.DatosPago.customer.billingDetails.identityCode=this.DatosCuenta.usuario.documento,this.DatosPago.customer.email=this.DatosCuenta.usuario.email,this.DatosPago.customer.billingDetails.cellPhoneNumber=this.DatosCuenta.usuario.telefono,this.DatosPago.customer.billingDetails.address=this.DatosCuenta.usuario.direccion}onFileChangePrincipal(n){if(n.target.files.length>0&&(this.selectedFileLogo=n.target.files[0],this.selectedFileLogo)){let a=new FileReader;a.onload=e=>{this.Logo=e.target.result},a.readAsDataURL(this.selectedFileLogo)}}MoveCarts(n,a){this.activeIndex=n,this.ProgressStyle.width=`${a}%`}toggleLoading(){this.FlagLoading=!this.FlagLoading}EstiloContenedorDatos={display:"block"};EstiloPasarella={display:"none"};ProcederAPago(){this.EstiloContenedorDatos.display="none",this.EstiloPasarella.display="block"}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=I({type:t,selectors:[["app-sign-up"]],inputs:{id:"id"},standalone:!0,features:[$],decls:68,vars:37,consts:[[1,"w-[80vw]","sm:max-w-screen-md","mx-auto","flex","flex-col","flex-nowrap","items-center","justify-center"],[1,"w-full","bg-gray-200","rounded-full","h-2.5","dark:bg-gray-700","mb-10"],[1,"bg-purple-600","h-2.5","rounded-full","transition-all","duration-700",3,"ngStyle"],[1,"flex","items-center","justify-center","w-56","h-56","border","border-gray-200","rounded-lg","bg-gray-50","dark:bg-gray-800","dark:border-gray-700"],[1,"w-full","max-h-screen","relative","overflow-hidden","transition-all",3,"ngStyle"],[1,"flex","h-full","transition-transform","duration-500",3,"ngStyle"],[1,"w-full","flex-shrink-0","flex","flex-col","items-center","justify-center","gap-5"],[1,"font-bold","text-2xl","text-purple-900"],[1,"flex","flex-row","flex-wrap","gap-3"],[1,"w-[48%]"],[3,"DataChange","Data","Name","Type","Placeholder"],[3,"DataChange","Data","Name"],[1,"w-[40%]","py-2","text-2xl","font-medium","text-center","text-white","bg-purple-600","rounded-lg","hover:bg-purple-700","focus:ring-4","focus:outline-none","focus:ring-purple-300","dark:bg-purple-500","dark:hover:bg-purple-600","dark:focus:ring-purple-900",3,"click"],[1,"w-full","flex-shrink-0","flex","flex-col","items-center","justify-start","gap-5"],[3,"DataChange","Data","Type","Name"],[1,"w-[48%]","mb-6"],["for","tiponegocio",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["id","tiponegocio","name","tiponegocio",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-teal-500","focus:border-teal-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-teal-500","dark:focus:border-teal-500",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[1,"text-gray-900",3,"value"],[1,"w-[48%]","flex","flex-row","flex-nowrap","gap-5","max-h-20"],[1,"mb-6","w-full"],["for","archivo",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","file","id","archivo","name","archivo","required","",1,"block","w-full","text-sm","text-gray-900","border","border-gray-300","rounded-lg","cursor-pointer","bg-gray-50","dark:text-gray-400","focus:outline-none","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400",3,"change"],["alt","logo",1,"rounded-md","h-full","object-contain",3,"src"],[1,"w-full","flex","flex-row","gap-4","items-center","justify-center"],["type","button",1,"w-[40%]","py-2","text-2xl","font-medium","text-gray-500","bg-white","rounded-lg","border","border-gray-200","hover:bg-gray-100","focus:ring-4","focus:outline-none","focus:ring-primary-300","hover:text-gray-900","focus:z-10","dark:bg-gray-700","dark:text-gray-300","dark:border-gray-500","dark:hover:text-white","dark:hover:bg-gray-600","dark:focus:ring-gray-600",3,"click"],["type","button",1,"w-[40%]","py-2","text-2xl","font-medium","text-center","text-white","bg-purple-600","rounded-lg","hover:bg-purple-700","focus:ring-4","focus:outline-none","focus:ring-purple-300","dark:bg-purple-500","dark:hover:bg-purple-600","dark:focus:ring-purple-900",3,"click"],[1,"flex","gap-2"],["type","button",1,"flex-1","py-2","px-3","text-sm","font-medium","text-gray-500","bg-white","rounded-lg","border","border-gray-200","hover:bg-gray-100","focus:ring-4","focus:outline-none","focus:ring-primary-300","hover:text-gray-900","focus:z-10","dark:bg-gray-700","dark:text-gray-300","dark:border-gray-500","dark:hover:text-white","dark:hover:bg-gray-600","dark:focus:ring-gray-600",3,"click"],[1,"container","md:max-w-screen-sm","text-center","h-96",3,"ngStyle"],["id","myPaymentForm"],["kr-popin","",1,"kr-smart-form"],["role","status"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"w-8","h-8","text-gray-200","animate-spin","dark:text-gray-600","fill-purple-600"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","currentColor"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentFill"],[1,"sr-only"]],template:function(a,e){a&1&&(o(0,"div",0)(1,"div",1),f(2,"div",2),l(),x(3,Ne,7,0,"div",3),o(4,"section",4)(5,"div",5)(6,"div",6)(7,"h2",7),m(8,"Datos del Titular"),l(),o(9,"div",8)(10,"div",9)(11,"app-input",10),d("DataChange",function(i){return e.DatosCuenta.usuario.email=i}),l()(),o(12,"div",9)(13,"app-input",10),d("DataChange",function(i){return e.DatosCuenta.usuario.password=i}),l()(),o(14,"div",9)(15,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.usuario.nombre=i}),l()(),o(16,"div",9)(17,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.usuario.apellido=i}),l()(),o(18,"div",9)(19,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.usuario.documento=i}),l()(),o(20,"div",9)(21,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.usuario.direccion=i}),l()(),o(22,"div",9)(23,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.usuario.telefono=i}),l()()(),o(24,"button",12),d("click",function(){return e.MoveCarts(1,50)}),m(25," Siguiente "),l()(),o(26,"div",13)(27,"h2",7),m(28,"Datos del Servicio"),l(),o(29,"div",8)(30,"div",9)(31,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.tenant.nombre=i}),l()(),o(32,"div",9)(33,"app-input",11),d("DataChange",function(i){return e.DatosCuenta.tenant.ruc=i}),l()(),o(34,"div",9)(35,"app-input",14),d("DataChange",function(i){return e.DatosCuenta.tenant.clavesol=i}),l()(),o(36,"div",15)(37,"label",16),m(38,"Tipo de Negocio"),l(),o(39,"select",17),z("ngModelChange",function(i){return G(e.DatosCuenta.tenant.tiponegocio,i)||(e.DatosCuenta.tenant.tiponegocio=i),i}),o(40,"option",18),m(41,"Elegir..."),l(),O(42,Le,2,2,"option",19,j),l()(),o(44,"div",9)(45,"app-input",14),d("DataChange",function(i){return e.DatosCuenta.tenant.dominio=i}),l()(),o(46,"div",20)(47,"div",21)(48,"label",22),m(49,"Ingrese su Logo"),l(),o(50,"input",23),d("change",function(i){return e.onFileChangePrincipal(i)}),l()(),x(51,Re,1,1,"img",24),l()(),o(52,"div",25)(53,"button",26),d("click",function(){return e.MoveCarts(0,0)}),m(54," Regresar "),l(),o(55,"button",27),d("click",function(){return e.MoveCarts(2,100)}),m(56," Continuar "),l()()(),o(57,"div",13)(58,"h2",7),m(59,"PAGO"),l(),o(60,"div",28)(61,"button",29),d("click",function(){return e.ProcesoPagoTarjeta()}),m(62," PROCESAR PAGO "),l()()()()(),o(63,"div",30)(64,"h2",7),m(65,"PAGO"),l(),o(66,"div",31),f(67,"div",32),l()()()),a&2&&(s(2),u("ngStyle",e.ProgressStyle),s(),P(e.FlagLoading?3:-1),s(),u("ngStyle",e.EstiloContenedorDatos),s(),u("ngStyle",B(35,Ue,"translateX(-"+e.activeIndex*100+"%)")),s(6),u("Data",e.DatosCuenta.usuario.email)("Name","Email")("Type","email")("Placeholder","ejemplo@gmail.com"),s(2),u("Data",e.DatosCuenta.usuario.password)("Name","Password")("Type","password")("Placeholder","**********"),s(2),u("Data",e.DatosCuenta.usuario.nombre)("Name","Nombres"),s(2),u("Data",e.DatosCuenta.usuario.apellido)("Name","Apellidos"),s(2),u("Data",e.DatosCuenta.usuario.documento)("Name","Dni"),s(2),u("Data",e.DatosCuenta.usuario.direccion)("Name","Direccion"),s(2),u("Data",e.DatosCuenta.usuario.telefono)("Name","Telefono"),s(8),u("Data",e.DatosCuenta.tenant.nombre)("Name","Nombre-del-Negocio"),s(2),u("Data",e.DatosCuenta.tenant.ruc)("Name","Ruc"),s(2),u("Data",e.DatosCuenta.tenant.clavesol)("Type","password")("Name","Clave-Sol"),s(4),q("ngModel",e.DatosCuenta.tenant.tiponegocio),s(3),K(e.tiposdeNegocio),s(3),u("Data",e.DatosCuenta.tenant.dominio)("Type","text")("Name","Dominio"),s(6),P(e.Logo?51:-1),s(12),u("ngStyle",e.EstiloPasarella))},dependencies:[re,ae,ie,ne,ee,te,X,W,oe]})};export{ce as SignUpComponent};
