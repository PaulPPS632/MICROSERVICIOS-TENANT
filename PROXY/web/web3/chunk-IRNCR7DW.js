import{a as o,c}from"./chunk-FRM5A7CD.js";import{J as n,N as u,S as i,g as l,k as m,o as g}from"./chunk-SLZJNV7T.js";var p={API_URL:"http://localhost:3000/api"};var h=class a{constructor(e){this.http=e}apiUrl=p.API_URL+"/tenant";tenantSubject=new l(null);get tenant$(){return this.tenantSubject.asObservable()}loadTenant(){let e=window.location.hostname;return this.http.get(`${this.apiUrl}/tenant/${e}`).pipe(n(t=>{this.tenantSubject.next(t)}))}postPasarela(e){let t=new o;return this.tenantSubject.asObservable().subscribe(r=>{t=new o({tenantid:r?.id||""})}),this.http.post(`${this.apiUrl}/tenant/pasarela`,e,{headers:t})}static \u0275fac=function(t){return new(t||a)(i(c))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};var b=class a{constructor(e,t){this.http=e;this.tenantService=t;this.cargarUsuario(),this.tenantService.tenant$.subscribe(r=>{this.tenant=r})}apiUrl=p.API_URL+"/tenant";usuarioSubject=new l(null);usuario$=this.usuarioSubject.asObservable();tenantId$=this.usuario$.pipe(g(e=>e?.TenantId||null));tenant=null;cargarUsuario(){this.getToken()&&this.isLoggedIn().subscribe(t=>{console.log(t),t.estado?this.usuarioSubject.next(t.user):this.logout()},t=>{console.error("Error al cargar el usuario",t),this.logout()})}register(e){return this.http.post(`${this.apiUrl}/entidad/register`,e).pipe(n(t=>{localStorage.setItem("authToken",t.token),localStorage.setItem("rol",t.rol),localStorage.setItem("User",JSON.stringify(t.usuario)),this.usuarioSubject.next(t.user)}))}registerNewTenant(e){return this.http.post(`${this.apiUrl}/tenant`,e).pipe(n(t=>{localStorage.setItem("authToken",t.token),localStorage.setItem("rol",t.rol),localStorage.setItem("User",JSON.stringify(t.usuario)),this.usuarioSubject.next(t.user)}))}registerNewTenantFormData(e){return this.http.post(`${this.apiUrl}/tenant/2`,e).pipe(n(t=>{localStorage.setItem("authToken",t.token),localStorage.setItem("rol",t.rol),localStorage.setItem("User",JSON.stringify(t.usuario)),this.usuarioSubject.next(t.user)}))}create(e){return this.http.post(`${this.apiUrl}/entidad/register`,e)}isLoggedIn(){let e=this.getToken();if(!e)return m({estado:!1,rol:"",user:null});let t={token:e};return this.http.post(`${this.apiUrl}/entidad/validate`,t).pipe(g(r=>({estado:r.estado,rol:r.rol,user:r.usuario})))}Logged(e,t){let r={email:e,password:t};return this.http.post(`${this.apiUrl}/entidad/login`,r).pipe(n(s=>{localStorage.setItem("authToken",s.token),localStorage.setItem("rol",s.rol),localStorage.setItem("User",JSON.stringify(s.usuario)),this.usuarioSubject.next(s.usuario)}))}logout(){localStorage.removeItem("authToken"),localStorage.removeItem("rol"),localStorage.removeItem("User"),this.usuarioSubject.next(null)}getToken(){return localStorage.getItem("authToken")}getRol(){return localStorage.getItem("rol")}getUsuario(){let e=localStorage.getItem("User");return e?JSON.parse(e):null}getHeadersAuthorization(){return new o({Authorization:`Bearer ${this.getToken()}`,tenantid:this.tenant?.id||""})}getHeaders(){return new o({tenantid:this.tenant?.id||""})}static \u0275fac=function(t){return new(t||a)(i(c),i(h))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{p as a,h as b,b as c};
