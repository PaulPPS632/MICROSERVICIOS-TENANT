import{a as K}from"./chunk-YRVV3GN6.js";import{a as J}from"./chunk-KTRCS3B2.js";import{a as Y}from"./chunk-F5UXNOVL.js";import{a as B,b as N,c as O,d as G,e as z,f as j,h as R,i as H,j as Z,k as A,l as U}from"./chunk-IUFCXTOM.js";import"./chunk-IRNCR7DW.js";import"./chunk-FRM5A7CD.js";import{l as L,m as q,o as I,p as F}from"./chunk-FFKOQB2C.js";import{Aa as v,Na as w,Qa as s,Sa as D,Ta as E,Ua as S,Va as M,Wa as o,X as V,Xa as r,Ya as u,Za as P,ab as h,bb as y,ea as b,fa as f,ga as k,ha as C,hb as d,jb as T,kb as Q,lb as m,mb as g,nb as p,pb as W,tb as _,ub as x,za as l}from"./chunk-SLZJNV7T.js";import"./chunk-EQDQRRRY.js";function ee(c,a){if(c&1){let t=P();o(0,"div",6),u(1,"div",39),o(2,"div",40)(3,"div",41)(4,"div",42)(5,"h3",43),d(6," Editar Tipado "),r(),o(7,"button",44),h("click",function(){b(t);let i=y();return f(i.ToggleEModal())}),k(),o(8,"svg",45),u(9,"path",46),r(),C(),o(10,"span",47),d(11,"Close modal"),r()()(),o(12,"div",48)(13,"div",7)(14,"label",49),d(15,"Fecha de Emisi\xF3n"),r(),o(16,"input",50),p("ngModelChange",function(i){b(t);let n=y();return g(n.fechaEmision,i)||(n.fechaEmision=i),f(i)}),r()(),o(17,"div",7)(18,"label",51),d(19,"Fecha de Vencimiento"),r(),o(20,"input",52),p("ngModelChange",function(i){b(t);let n=y();return g(n.fechaVencimiento,i)||(n.fechaVencimiento=i),f(i)}),r()()()()()()}if(c&2){let t=y();l(16),m("ngModel",t.fechaEmision),l(4),m("ngModel",t.fechaVencimiento)}}function te(c,a){if(c&1&&(o(0,"option",22),d(1),r()),c&2){let t=a.$implicit;s("value",t.id),l(),Q(" ",t.documento," | ",t.nombre," ")}}function ie(c,a){if(c&1&&(o(0,"option",22),d(1),r()),c&2){let t=a.$implicit;s("value",t.id),l(),T(" ",t.nombre," ")}}function ne(c,a){if(c&1){let t=P();o(0,"tr",53)(1,"td",54)(2,"input",55),p("ngModelChange",function(i){let n=b(t).$implicit;return g(n.cantidad,i)||(n.cantidad=i),f(i)}),h("change",function(){let i=b(t).$index,n=y(2);return f(n.recalcularPrecio(i))}),r()(),o(3,"td",56)(4,"input",57),p("ngModelChange",function(i){let n=b(t).$implicit;return g(n.nombre,i)||(n.nombre=i),f(i)}),r()(),o(5,"td",58)(6,"span"),d(7,"S/."),r(),o(8,"input",59),p("ngModelChange",function(i){let n=b(t).$implicit;return g(n.precio_unitario,i)||(n.precio_unitario=i),f(i)}),h("change",function(){let i=b(t).$index,n=y(2);return f(n.recalcularPrecio(i))}),r()(),o(9,"td",60),d(10),_(11,"currency"),r()()}if(c&2){let t=a.$implicit,e=a.$index;l(2),s("name","cant_"+e)("id","cant_"+e),m("ngModel",t.cantidad),l(2),s("name","nombre_"+e)("id","nombre_"+e),m("ngModel",t.nombre),l(4),s("name","precio_unitario_"+e)("id","precio_unitario_"+e),m("ngModel",t.precio_unitario),l(2),T(" ",x(11,10,t.precio_total,"S/. ")," ")}}function oe(c,a){if(c&1&&(o(0,"tbody"),S(1,ne,12,13,"tr",53,E),r()),c&2){let t=y();l(),M(t.ventaData.detalles)}}var X=class c{constructor(a,t,e){this.productoService=a;this.entidadService=t;this.cotizacionService=e}fechaEmision;fechaVencimiento;EditOpen=!1;detalleVenta=[];selectedProducto="";selectedEntidad="";entidad="";entidades=[];filtroEntidad=[];idproductoSeleccionado="";ventaData={cliente:{id:"",documento:"",nombre:"",direccion:""},usuario_id:"",fecha_emision:new Date().toISOString(),fecha_vencimiento:new Date().toISOString(),nota:"",gravada:this.totalGravada,impuesto:this.igv,total:this.totalPagar,detalles:this.detalleVenta};listaProductos=[];ngOnInit(){this.setFechaEmision(),this.cargarProductos(),this.cargarClientes()}guardarProductos(){this.ventaData.gravada=this.totalGravada,this.ventaData.impuesto=this.igv,this.ventaData.total=this.totalPagar,console.log(this.ventaData),this.cotizacionService.registrar(this.ventaData).subscribe(a=>{console.log(a),window.open(a.ruta,"_blank")})}cargarProductos(){this.productoService.getListaProductos().subscribe(a=>{console.log(a),this.listaProductos=a},a=>{console.error("Error al obtener los productos:",a)})}cargarClientes(){this.entidadService.getEntidades().subscribe(a=>{this.entidades=a,this.filtroEntidad=a})}setFechaEmision(){let a=new Date,t=a.getDate().toString().padStart(2,"0"),e=(a.getMonth()+1).toString().padStart(2,"0"),i=a.getFullYear();this.fechaEmision=`${i}-${e}-${t}`,this.fechaVencimiento=`${i}-${e}-${t}`}ElegirSeries(a){let e=a.target.value.toLowerCase();if(console.log(e),e){let i=this.ventaData.detalles.find(n=>n.id_producto==e);if(console.log(i),!i){let n=this.listaProductos.find($=>$.id==e);i={id_producto:e,nombre:n?.nombre,cantidad:1,series:[],precio_unitario:n?.precio,precio_total:n?.precio},this.ventaData.detalles.push(i)}}}buscarCliente(a){let e=a.target.value.toLowerCase();e?this.filtroEntidad=this.filtroEntidad.filter(i=>i.documento.toLowerCase().includes(e)||i.nombre.toLowerCase().includes(e.toLowerCase())):this.filtroEntidad=this.entidades}ElegirEntidad(){let a=this.entidades.find(t=>t.id==this.ventaData.cliente.id);this.entidad=a?.nombre||"",this.ventaData.cliente.documento=a?.documento,this.ventaData.cliente.nombre=a?.nombre,this.ventaData.cliente.direccion=a?.direccion}recalcularPrecio(a){let t=this.ventaData.detalles[a];t.cantidad&&t.precio_unitario?t.precio_total=t.cantidad*t.precio_unitario:t.precio_total=0}get totalGravada(){return this.totalPagar/1.18}get igv(){return this.totalGravada*.18}get totalPagar(){return this.detalleVenta.reduce((a,t)=>a+t.precio_total,0)}ToggleEModal(){this.EditOpen=!this.EditOpen}static \u0275fac=function(t){return new(t||c)(v(Y),v(J),v(K))};static \u0275cmp=V({type:c,selectors:[["app-quotation"]],standalone:!0,features:[W],decls:80,vars:20,consts:[[1,"text-2xl","text-center","font-extrabold","text-gray-800","dark:text-white"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-3"],["role","button","tabindex","0","aria-label","Abrir modal",1,"icon-container",3,"click","keydown.enter","keydown.space"],["xmlns","http://www.w3.org/2000/svg","height","40px","viewBox","0 -960 960 960","width","30px","fill","#000000"],["d","m382-80-18.67-126.67q-17-6.33-34.83-16.66-17.83-10.34-32.17-21.67L178-192.33 79.33-365l106.34-78.67q-1.67-8.33-2-18.16-.34-9.84-.34-18.17 0-8.33.34-18.17.33-9.83 2-18.16L79.33-595 178-767.67 296.33-715q14.34-11.33 32.34-21.67 18-10.33 34.66-16L382-880h196l18.67 126.67q17 6.33 35.16 16.33 18.17 10 31.84 22L782-767.67 880.67-595l-106.34 77.33q1.67 9 2 18.84.34 9.83.34 18.83 0 9-.34 18.5Q776-452 774-443l106.33 78-98.66 172.67-118-52.67q-14.34 11.33-32 22-17.67 10.67-35 16.33L578-80H382Zm55.33-66.67h85l14-110q32.34-8 60.84-24.5T649-321l103.67 44.33 39.66-70.66L701-415q4.33-16 6.67-32.17Q710-463.33 710-480q0-16.67-2-32.83-2-16.17-7-32.17l91.33-67.67-39.66-70.66L649-638.67q-22.67-25-50.83-41.83-28.17-16.83-61.84-22.83l-13.66-110h-85l-14 110q-33 7.33-61.5 23.83T311-639l-103.67-44.33-39.66 70.66L259-545.33Q254.67-529 252.33-513 250-497 250-480q0 16.67 2.33 32.67 2.34 16 6.67 32.33l-91.33 67.67 39.66 70.66L311-321.33q23.33 23.66 51.83 40.16 28.5 16.5 60.84 24.5l13.66 110Zm43.34-200q55.33 0 94.33-39T614-480q0-55.33-39-94.33t-94.33-39q-55.67 0-94.5 39-38.84 39-38.84 94.33t38.84 94.33q38.83 39 94.5 39ZM480-480Z"],["tabindex","-1","aria-hidden","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"mb-6"],["for","entidad",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"flex","items-center","space-x-3"],["type","text","id","entidad","name","entidad","placeholder","Buscar por cliente...","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"input","ngModelChange","ngModel"],["id","selectedEntidad","name","selectedEntidad","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"change","ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"inline-flex","items-center","rounded-lg","bg-blue-700","px-5","py-2.5","text-sm","font-medium","text-white","hover:bg-blue-800","focus:outline-none","focus:ring-4","focus:ring-blue-300","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800"],["for","nota",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","id","nota","name","nota","placeholder","Nota venta",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"grid","gap-6","mb-6","md:grid-cols-2"],["for","serie",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","id","serie","name","serie","placeholder","Ingrese serie...","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"ngModelChange","ngModel"],["for","n_producto",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["id","n_producto","name","n_producto",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"ngModelChange","change","ngModel"],[3,"value"],[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],[1,"w-full","text-sm","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"px-6","py-3","max-w-16"],["scope","col",1,"px-6","py-3","min-w-80"],["scope","col",1,"px-6","py-3","max-w-32"],["scope","col",1,"px-6","py-3","w-fit"],[4,"ngIf"],["for","gra",1,"form-label"],["type","text","id","gra","disabled","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"value"],["for","igv",1,"form-label"],["type","text","id","igv","disabled","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"value"],["for","pagar",1,"form-label"],["type","text","id","pagar","disabled","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"value"],[1,"my-4"],["type","submit",1,"w-full","items-center","rounded-lg","bg-blue-700","px-5","py-2.5","text-sm","font-medium","text-white","hover:bg-blue-800","focus:outline-none","focus:ring-4","focus:ring-blue-300","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50"],[1,"relative","flex","items-center","justify-center","min-h-screen","p-4"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700","max-w-2xl","w-full"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-4","md:p-5","space-y-4"],["for","fecha-emision",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","date","id","fecha-emision","name","fechaEmision","placeholder","yyyy-mm-dd",1,"w-full","p-2","border","border-gray-300","rounded-md","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["for","fecha-venci",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","date","id","fecha-venci","name","fechaVencimiento","placeholder","yyyy-mm-dd",1,"w-full","p-2","border","border-gray-300","rounded-md","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"bg-white","border-b","dark:bg-gray-800","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-600"],[1,"pl-6","max-w-16"],["type","text","oninput","this.value = this.value.replace(/[^1-9]/g, '')",1,"inputcotizacion","max-w-16","text-lg",3,"ngModelChange","change","name","id","ngModel"],[1,"px-6","py-4","min-w-80"],["type","text",1,"inputcotizacion","w-full","text-lg",3,"ngModelChange","name","id","ngModel"],[1,"px-6","py-4","flex","flex-row","flex-nowrap","items-center","align-middle","max-w-32"],["type","text","oninput","this.value = this.value.replace(/[^0-9.]/g, '')",1,"inputcotizacion","max-w-32","text-lg",3,"ngModelChange","change","name","id","ngModel"],[1,"px-6","py-4","w-fit","text-lg"]],template:function(t,e){t&1&&(o(0,"p",0),d(1," Cotizacion "),r(),u(2,"br"),o(3,"div",1)(4,"h2",2)(5,"b"),d(6,"Informaci\xF3n"),r()(),o(7,"div",3),h("click",function(){return e.ToggleEModal()})("keydown.enter",function(){return e.ToggleEModal()})("keydown.space",function(){return e.ToggleEModal()}),k(),o(8,"svg",4),u(9,"path",5),r()()(),w(10,ee,21,2,"div",6),C(),o(11,"form")(12,"div",7)(13,"label",8),d(14,"Cliente (Id/Nombre)"),r(),o(15,"div",9)(16,"input",10),h("input",function(n){return e.buscarCliente(n)}),p("ngModelChange",function(n){return g(e.entidad,n)||(e.entidad=n),n}),r(),o(17,"select",11),h("change",function(){return e.ElegirEntidad()}),p("ngModelChange",function(n){return g(e.ventaData.cliente.id,n)||(e.ventaData.cliente.id=n),n}),o(18,"option",12),d(19,"Elegir..."),r(),w(20,te,2,3,"option",13),r(),o(21,"button",14),d(22," Nuevo "),r()()(),o(23,"div",7)(24,"label",15),d(25,"Nota (Opcional)"),r(),o(26,"input",16),p("ngModelChange",function(n){return g(e.ventaData.nota,n)||(e.ventaData.nota=n),n}),r()(),o(27,"div",17)(28,"div")(29,"label",18),d(30,"Serie Producto"),r(),o(31,"input",19),p("ngModelChange",function(n){return g(e.ventaData.serie,n)||(e.ventaData.serie=n),n}),r()(),o(32,"div")(33,"label",20),d(34,"."),r(),o(35,"select",21),p("ngModelChange",function(n){return g(e.selectedProducto,n)||(e.selectedProducto=n),n}),h("change",function(n){return e.ElegirSeries(n)}),o(36,"option",12),d(37,"Elegir..."),r(),S(38,ie,2,2,"option",22,E),r()()()(),u(40,"hr"),o(41,"div",23)(42,"table",24)(43,"thead",25)(44,"tr")(45,"th",26),d(46,"Cantidad"),r(),o(47,"th",27),d(48,"Descripcion"),r(),o(49,"th",28),d(50,"P. Unit"),r(),o(51,"th",29),d(52,"P. Total"),r()()(),w(53,oe,3,0,"tbody",30),r()(),u(54,"hr")(55,"br"),o(56,"div",17)(57,"div")(58,"label",31),d(59,"Gravada (sin IGV)"),r()(),o(60,"div"),u(61,"input",32),_(62,"currency"),r()(),o(63,"div",17)(64,"div")(65,"label",33),d(66,"Impuesto IGV (18%)"),r()(),o(67,"div"),u(68,"input",34),_(69,"currency"),r()(),o(70,"div",17)(71,"div")(72,"label",35),d(73,"Total Pagar"),r()(),o(74,"div"),u(75,"input",36),_(76,"currency"),r()(),u(77,"hr",37),o(78,"button",38),h("click",function(){return e.guardarProductos()}),d(79," Generar Cotizacion "),r()),t&2&&(l(10),D(e.EditOpen?10:-1),l(6),m("ngModel",e.entidad),l(),m("ngModel",e.ventaData.cliente.id),l(3),s("ngForOf",e.filtroEntidad),l(6),m("ngModel",e.ventaData.nota),l(5),m("ngModel",e.ventaData.serie),l(4),m("ngModel",e.selectedProducto),l(3),M(e.listaProductos),l(15),s("ngIf",e.ventaData.detalles&&e.ventaData.detalles.length>0),l(8),s("value",x(62,11,e.totalGravada,"S/. ")),l(7),s("value",x(69,14,e.igv,"S/. ")),l(7),s("value",x(76,17,e.totalPagar,"S/. ")))},dependencies:[F,L,q,I,U,j,H,Z,B,R,N,O,A,z,G]})};export{X as QuotationComponent};
