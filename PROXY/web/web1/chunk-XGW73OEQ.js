import{$a as M,D as K,K as Q,O as X,S as C,Y as y,a as W,c as B,dc as g,ec as D,f as $,fc as w,ga as Y,h as G,ha as x,l as H,n as S,pa as h,q as k,ra as v}from"./chunk-LXSEPEJS.js";import{a as m,b as U}from"./chunk-GAL4ENT6.js";function I(e){e||(x(I),e=y(v));let s=new B(t=>e.onDestroy(t.next.bind(t)));return t=>t.pipe(X(s))}function N(e,s){!s?.injector&&x(N);let t=s?.injector??y(h),n=new G(1),r=w(()=>{let u;try{u=e()}catch(a){D(()=>n.error(a));return}D(()=>n.next(u))},{injector:t,manualCleanup:!0});return t.get(v).onDestroy(()=>{r.destroy(),n.complete()}),n.asObservable()}function z(e,s,t){!s&&x(e);let n=s??y(h);return t?Y(n,t):n}function j(e,...s){let[t,n,r,u,a]=te(s);if(t){let d=null;return r instanceof v?d=r:d=z(j,r).get(v),t.pipe(I(d)).subscribe(o=>{let f=()=>{e.update(c=>{if(!E(c))return n?.(c,o)||o;if(!E(o)){let i=n?n(c,o):o;return E(i)?m(m({},c),i):i}return m(m({},c),n?.(c,o)||o)})};u?D(f):f()})}if(a){let d=r instanceof h?z(j,r):void 0;return w(()=>{e.update(o=>E(o)?m(m({},o),a()):a())},{allowSignalWrites:!0,injector:d})}return{with(...d){if(!this.subscription)this.subscription=new W;else if(this.subscription.closed)return console.info("[ngxtension connect] ConnectedSignal has been closed."),this;return this.subscription.add(j(e,...d,r,u)),this},subscription:null}}function te(e){return e.length>3?[e[0],e[1],e[2],e[3],null]:e.length===3?typeof e[2]=="boolean"?S(e[0])?[e[0],null,e[1],e[2],null]:[null,null,e[1],e[2],e[0]]:[e[0],e[1],e[2],!1,null]:e.length===2?typeof e[1]=="boolean"?[null,null,e[0],e[1],null]:typeof e[1]=="function"?[e[0],e[1],null,!1,null]:[e[0],null,e[1],!1,null]:S(e[0])?[e[0],null,null,!1,null]:typeof e[0]=="function"?[null,null,null,!1,e[0]]:[null,null,e[0],!1,null]}function E(e){return typeof e=="object"&&e!==void 0&&e!==null&&!Array.isArray(e)}function V(e){let s=y(v),t=y(h),{initialState:n,sources:r=[],lazySources:u=[],actionSources:a={},selectors:d=()=>({}),effects:o=()=>({}),actionEffects:f=()=>({})}=e,c=M(n),i=c.asReadonly(),A=N(c),L=!1,q=[],O=i;Z(c,r);for(let[l,p]of Object.entries(a)){let b=new $;if(q.push(b),S(p))_(i,A,l,s,p,q,b);else{let R=new $,T=p(i,R).pipe(Q());j(c,T),_(i,A,l,s,R,q,b,T)}let P=f(O);b.subscribe(R=>{let F=P[R.name];F&&F(R)})}for(let l in n)Object.defineProperty(i,l,{value:g(()=>i()[l])});for(let[l,p]of Object.entries(d(O)))Object.defineProperty(i,l,{value:g(p)});for(let[l,p]of Object.entries(o(O)))Object.defineProperty(O,l,{value:w(b=>{let P=p();P&&b(()=>P())})});s.onDestroy(()=>{q.forEach(l=>l.complete())});let J=()=>{L||(L=!0,Z(c,u,t,!0))};return new Proxy(O,{get(l,p,b){return J(),Reflect.get(l,p,b)},apply(l,p,b){return J(),Reflect.apply(l,p,b)}})}function Z(e,s,t,n=!1){for(let r of s)S(r)?j(e,r,t,n):j(e,r(e.asReadonly()),t,n)}function _(e,s,t,n,r,u,a,d){Object.defineProperties(e,{[t]:{value:o=>S(o)?new Promise((f,c)=>{o.pipe(I(n)).subscribe({next:i=>{a.next({name:t,payload:o,value:i,err:void 0}),r.next(i)},error:i=>{a.next({name:t,payload:o,value:void 0,err:i}),r.error(i),c(i)},complete:()=>{r.complete(),f(e())}})}):(d&&d.pipe(I(n)).subscribe({next:f=>{a.next({name:t,payload:o,value:f,err:void 0})},error:f=>{a.next({name:t,payload:o,value:void 0,err:f})}}),new Promise(f=>{s.pipe(K(1)).subscribe(c=>{f(c)}),r.next(o)}))},[`${t}$`]:{value:r.asObservable()}}),u.push(r)}var ee=(()=>{class e{loadProducts(){let t=localStorage.getItem("products");return H(t?JSON.parse(t):[])}saveProducts(t){localStorage.setItem("products",JSON.stringify(t))}static \u0275fac=function(n){return new(n||e)};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ce=(()=>{class e{_storageService=y(ee);initialState={products:[],loaded:!1};loadProducts$=this._storageService.loadProducts().pipe(k(t=>({products:t,loaded:!0})));state=V({initialState:this.initialState,sources:[this.loadProducts$],selectors:t=>({count:()=>t().products.reduce((n,r)=>n+r.quantity,0),price:()=>t().products.reduce((n,r)=>n+r.product.precio*r.quantity,0)}),actionSources:{add:(t,n)=>n.pipe(k(r=>this.add(t,r))),remove:(t,n)=>n.pipe(k(r=>this.remove(t,r))),udpate:(t,n)=>n.pipe(k(r=>this.update(t,r)))},effects:t=>({load:()=>{t().loaded&&this._storageService.saveProducts(t().products)}})});add(t,n){let r=t().products.find(u=>u.product.id===n.product.id);return r?(r.quantity+=1,{products:[...t().products]}):{products:[...t().products,U(m({},n),{quantity:1})]}}remove(t,n){return{products:t().products.filter(r=>r.product.id!==n)}}update(t,n){return{products:t().products.map(u=>u.product.id===n.product.id?U(m({},u),{quantity:n.quantity}):u)}}static \u0275fac=function(n){return new(n||e)};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Fe={API_URL:"http://localhost:3000/api"};export{I as a,V as b,Ce as c,Fe as d};
